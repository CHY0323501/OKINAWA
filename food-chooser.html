<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šå¤©åƒä»€éº¼ï¼Ÿ(å³æ™‚æœ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* å‹•ç•«ç‰¹æ•ˆ */
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.1); }
        
        .gradient-btn {
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
            transition: all 0.3s;
        }
        .gradient-btn:hover { filter: brightness(110%); transform: scale(1.02); }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #F97316;
            border-radius: 50%;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .modal-enter { animation: modalIn 0.3s ease-out forwards; }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* éª¨æ¶å±è¼‰å…¥å‹•ç•« */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="text-gray-800 pb-20">

    <!-- å°èˆªåˆ— -->
    <nav class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-40">
        <div class="max-w-4xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2" onclick="window.location.reload()">
                <div class="bg-orange-100 p-2 rounded-full text-orange-600"><i class="fa-solid fa-location-dot"></i></div>
                <h1 class="font-bold text-lg tracking-tight cursor-pointer">é™„è¿‘åƒä»€éº¼ <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">Real-time</span></h1>
            </div>
            <button onclick="getUserLocation()" class="text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full transition flex items-center gap-1">
                <i class="fa-solid fa-crosshairs text-orange-500"></i> <span id="loc-status">æ›´æ–°ä½ç½®</span>
            </button>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹ -->
    <main class="max-w-4xl mx-auto px-4 py-6">
        
        <!-- éš¨æ©ŸæŒ‰éˆ•å€ -->
        <div class="text-center mb-8 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
            <h2 class="text-2xl font-bold mb-2 text-gray-800">ä»Šå¤©åƒä»€éº¼ï¼Ÿ</h2>
            <p class="text-gray-500 mb-6 text-sm">æœå°‹ç¯„åœï¼š<span id="range-display">1</span> å…¬é‡Œå…§çš„çœŸå¯¦åº—å®¶</p>
            
            <div class="flex gap-2 justify-center mb-4">
                 <!-- ç¯„åœé¸æ“‡ -->
                <select id="radius-select" class="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm outline-none focus:border-orange-500" onchange="fetchData()">
                    <option value="500">èµ°è·¯å» (500m)</option>
                    <option value="1000" selected>é™„è¿‘ (1km)</option>
                    <option value="2000">é¨è»Šå» (2km)</option>
                    <option value="5000">é–‹è»Šå» (5km)</option>
                </select>
                <!-- é¡å‹é¸æ“‡ -->
                <select id="type-select" class="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm outline-none focus:border-orange-500" onchange="applyFilters()">
                    <option value="all">æ‰€æœ‰é¡å‹</option>
                    <option value="asian">ğŸœ äºæ´²/å°æ—¥éŸ“</option>
                    <option value="western">ğŸ” è¥¿å¼/é€Ÿé£Ÿ</option>
                    <option value="cafe">â˜• å’–å•¡/ç”œé»</option>
                    <option value="bar">ğŸº é…’å§/å®µå¤œ</option>
                </select>
            </div>

            <button onclick="spinTheWheel()" id="random-btn" class="gradient-btn w-full sm:w-auto text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-orange-200 flex items-center justify-center gap-2 mx-auto disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fa-solid fa-dice text-xl"></i> å¹«æˆ‘é¸ä¸€å®¶ï¼
            </button>
        </div>

        <!-- ç‹€æ…‹æç¤º -->
        <div id="status-msg" class="text-center text-sm text-gray-500 mb-4 h-6"></div>

        <!-- åˆ—è¡¨å€ -->
        <div class="flex justify-between items-end mb-4 px-1">
            <h3 class="font-bold text-lg">é™„è¿‘åº—å®¶ <span id="count-badge" class="text-sm font-normal text-gray-400 ml-1">(0)</span></h3>
            <div class="text-xs text-gray-400">è³‡æ–™ä¾†æº: OpenStreetMap</div>
        </div>

        <div id="cards-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- é€™è£¡æœƒå‹•æ…‹æ’å…¥å¡ç‰‡ -->
            <!-- é è¨­é¡¯ç¤ºéª¨æ¶å± -->
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 h-32 flex gap-4">
                <div class="w-24 h-24 rounded-lg skeleton flex-shrink-0"></div>
                <div class="flex-1 space-y-2 py-1">
                    <div class="h-4 w-3/4 skeleton rounded"></div>
                    <div class="h-3 w-1/2 skeleton rounded"></div>
                    <div class="h-8 w-full skeleton rounded mt-2"></div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 h-32 flex gap-4">
                <div class="w-24 h-24 rounded-lg skeleton flex-shrink-0"></div>
                <div class="flex-1 space-y-2 py-1">
                    <div class="h-4 w-3/4 skeleton rounded"></div>
                    <div class="h-3 w-1/2 skeleton rounded"></div>
                    <div class="h-8 w-full skeleton rounded mt-2"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal: çµæœè¦–çª— -->
    <div id="result-modal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="closeModal(event)">
        <div class="bg-white rounded-2xl w-full max-w-sm overflow-hidden modal-enter relative shadow-2xl" onclick="event.stopPropagation()">
            <button onclick="closeModal()" class="absolute top-3 right-3 z-10 bg-black/20 hover:bg-black/40 text-white rounded-full w-8 h-8 flex items-center justify-center backdrop-blur-md transition">
                <i class="fa-solid fa-xmark"></i>
            </button>
            
            <div class="relative h-56">
                <img id="modal-img" src="" class="w-full h-full object-cover">
                <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/80 via-black/40 to-transparent p-4 text-white">
                    <div class="bg-orange-500 text-xs font-bold px-2 py-0.5 rounded inline-block mb-1" id="modal-tag">é¡å‹</div>
                    <h2 class="text-2xl font-bold leading-tight" id="modal-name">åº—å</h2>
                    <p class="text-sm opacity-90 mt-1"><i class="fa-solid fa-location-arrow mr-1"></i>è·é›¢ <span id="modal-dist"></span></p>
                </div>
            </div>

            <div class="p-6">
                <div class="bg-orange-50 border border-orange-100 rounded-lg p-3 mb-4 text-sm text-gray-700 flex gap-3 items-start">
                    <i class="fa-solid fa-circle-info text-orange-500 mt-0.5"></i>
                    <div>
                        <p class="font-bold">å°æç¤º</p>
                        <p class="text-xs text-gray-500">å› ç‚ºæ²’æœ‰ä»˜è²» APIï¼Œæˆ‘å€‘ç„¡æ³•ç›´æ¥é¡¯ç¤ºè©•åˆ†ã€‚è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•æŸ¥çœ‹ Google çœŸå¯¦è©•åƒ¹ï¼</p>
                    </div>
                </div>

                <div class="space-y-3">
                    <a id="modal-google-link" href="#" target="_blank" class="block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-200 transition">
                        <i class="fa-brands fa-google mr-1"></i> æŸ¥çœ‹ Google è©•åˆ†èˆ‡èœå–®
                    </a>
                    <div class="grid grid-cols-2 gap-3">
                         <a id="modal-map-link" href="#" target="_blank" class="block w-full text-center border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2.5 rounded-xl transition">
                            <i class="fa-solid fa-diamond-turn-right mr-1"></i> å°èˆª
                        </a>
                        <button onclick="spinTheWheel()" class="block w-full text-center border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2.5 rounded-xl transition">
                            <i class="fa-solid fa-rotate mr-1"></i> æ›ä¸€å®¶
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒé‚è¼¯å€ ---

        let allRestaurants = [];
        let filteredRestaurants = [];
        let userLat = 25.0478; // é è¨­å°åŒ—è»Šç«™
        let userLon = 121.5170;
        let isLocating = false;

        // åœ–ç‰‡é—œéµå­—æ˜ å°„ (å› ç‚º OSM æ²’æœ‰åœ–ç‰‡ï¼Œæˆ‘å€‘ç”¨ Unsplash/LoremFlickr æ ¹æ“šé—œéµå­—é…åœ–)
        const cuisineImages = {
            'asian': 'noodle,rice,sushi',
            'western': 'burger,pizza,steak',
            'cafe': 'coffee,cake,bread',
            'bar': 'beer,cocktail,pub',
            'default': 'food,restaurant'
        };

        // åˆå§‹åŒ–
        window.onload = function() {
            getUserLocation();
        };

        // 1. ç²å–ä½¿ç”¨è€…ä½ç½®
        function getUserLocation() {
            const status = document.getElementById('status-msg');
            const btnText = document.getElementById('loc-status');
            
            if (!navigator.geolocation) {
                status.innerText = "æ‚¨çš„è£ç½®ä¸æ”¯æ´åœ°ç†å®šä½";
                fetchData(); // ä½¿ç”¨é è¨­ä½ç½®
                return;
            }

            status.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-1"></i> æ­£åœ¨å®šä½ä¸­...';
            btnText.innerText = "å®šä½ä¸­...";
            isLocating = true;

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLat = position.coords.latitude;
                    userLon = position.coords.longitude;
                    status.innerText = "å·²é–å®šæ‚¨çš„ä½ç½®";
                    btnText.innerText = "ç•¶å‰ä½ç½®";
                    isLocating = false;
                    fetchData(); // å–å¾—ä½ç½®å¾Œé¦¬ä¸ŠæŠ“è³‡æ–™
                },
                (error) => {
                    console.error(error);
                    status.innerText = "ç„¡æ³•ç²å–ä½ç½®ï¼Œå°‡æœå°‹å°åŒ—è»Šç«™å‘¨é‚Š";
                    btnText.innerText = "é è¨­ä½ç½®";
                    isLocating = false;
                    fetchData(); // å¤±æ•—å‰‡ä½¿ç”¨é è¨­
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        }

        // 2. å¾ OpenStreetMap (Overpass API) æŠ“å–çœŸå¯¦è³‡æ–™
        async function fetchData() {
            const radius = document.getElementById('radius-select').value;
            const container = document.getElementById('cards-container');
            const status = document.getElementById('status-msg');
            const randomBtn = document.getElementById('random-btn');

            // Loading State
            randomBtn.disabled = true;
            status.innerHTML = `<i class="fa-solid fa-satellite-dish fa-fade mr-1"></i> æ­£åœ¨æƒæå‘¨é‚Š m çš„ç¾é£Ÿè³‡æ–™...`;
            container.innerHTML = `
                <div class="col-span-full py-10 text-center">
                    <div class="spinner mx-auto mb-4"></div>
                    <p class="text-gray-400">æ­£åœ¨é€£ç·šè‡³ OpenStreetMap...</p>
                </div>
            `;

            // Overpass QL æŸ¥è©¢èªå¥ (æŸ¥è©¢é™„è¿‘çš„é¤å»³ã€å’–å•¡å»³ã€é€Ÿé£Ÿã€é…’å§)
            const query = `
                [out:json][timeout:25];
                (
                  node["amenity"~"restaurant|cafe|fast_food|bar|pub"](around:,,);
                  way["amenity"~"restaurant|cafe|fast_food|bar|pub"](around:,,);
                );
                out center 50;
            `; 
            // é™åˆ¶æœ€å¤š 50 ç­†ä»¥åŠ å¿«é€Ÿåº¦

            try {
                const response = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    body: query
                });
                
                if (!response.ok) throw new Error('Network response was not ok');
                
                const data = await response.json();
                processData(data.elements);

            } catch (error) {
                console.error('Fetch error:', error);
                container.innerHTML = `
                    <div class="col-span-full text-center py-10 text-red-400">
                        <i class="fa-solid fa-triangle-exclamation text-3xl mb-2"></i>
                        <p>è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦</p>
                        <button onclick="fetchData()" class="mt-4 px-4 py-2 bg-gray-200 rounded-lg text-sm">é‡è©¦</button>
                    </div>
                `;
                status.innerText = "é€£ç·šéŒ¯èª¤";
            } finally {
                randomBtn.disabled = false;
            }
        }

        // 3. è™•ç†è³‡æ–™
        function processData(elements) {
            allRestaurants = elements.map(item => {
                // è™•ç† Way (å¤šé‚Šå½¢) é¡å‹çš„ä¸­å¿ƒé»
                const lat = item.lat || item.center.lat;
                const lon = item.lon || item.center.lon;
                const tags = item.tags || {};
                
                // å¿½ç•¥æ²’æœ‰åå­—çš„é»
                if (!tags.name) return null;

                // è¨ˆç®—è·é›¢
                const dist = calculateDistance(userLat, userLon, lat, lon);

                // åˆ¤æ–·é¡å‹ (ç°¡å–®åˆ†é¡)
                let category = 'asian'; // default
                let rawType = tags.cuisine || tags.amenity;
                
                if (tags.amenity === 'cafe') category = 'cafe';
                else if (tags.amenity === 'bar' || tags.amenity === 'pub') category = 'bar';
                else if (['burger', 'pizza', 'sandwich', 'american', 'italian'].some(x => (tags.cuisine || '').includes(x))) category = 'western';
                else if (tags.cuisine === 'japanese' || tags.cuisine === 'korean' || tags.cuisine === 'chinese') category = 'asian';

                return {
                    id: item.id,
                    name: tags.name,
                    lat: lat,
                    lon: lon,
                    dist: dist,
                    type: category,
                    rawType: rawType,
                    // éš¨æ©Ÿç”¢ç”Ÿä¸€å€‹é—œéµå­—ä¾†æ‰¾åœ–
                    imgKeyword: getImageKeyword(category) 
                };
            }).filter(item => item !== null);

            // ä¾è·é›¢æ’åº
            allRestaurants.sort((a, b) => a.dist - b.dist);

            applyFilters();
        }

        // 4. ç¯©é¸èˆ‡æ¸²æŸ“
        function applyFilters() {
            const typeFilter = document.getElementById('type-select').value;
            const container = document.getElementById('cards-container');
            const countBadge = document.getElementById('count-badge');
            const status = document.getElementById('status-msg');

            filteredRestaurants = allRestaurants.filter(item => {
                if (typeFilter === 'all') return true;
                return item.type === typeFilter;
            });

            countBadge.innerText = `()`;
            status.innerText = `æ‰¾åˆ°  å®¶åº—å®¶`;

            container.innerHTML = '';
            
            if (filteredRestaurants.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-10 text-gray-400">
                        <i class="fa-solid fa-wind text-4xl mb-3"></i>
                        <p>é€™é™„è¿‘ä¼¼ä¹æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„åº—å®¶...</p>
                        <p class="text-xs mt-1">è©¦è©¦çœ‹æ“´å¤§ç¯„åœï¼Ÿ</p>
                    </div>
                `;
                return;
            }

            filteredRestaurants.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl p-3 shadow-sm border border-gray-100 flex gap-3 card-hover cursor-pointer';
                card.onclick = () => showModal(item);

                // ä½¿ç”¨ LoremFlickr æˆ–é¡ä¼¼æœå‹™å–å¾—åœ–ç‰‡ (Unsplash Source å·²ä¸ç©©å®šï¼Œé€™è£¡ç”¨ Picsum æˆ– fakeimg ä½œç‚ºç¤ºç¯„ï¼Œæˆ–ä½¿ç”¨éš¨æ©Ÿé¡è‰²)
                // ç‚ºäº†ç¾è§€ï¼Œé€™è£¡ä½¿ç”¨ä¸€å€‹åŸºæ–¼é¡å‹çš„éš¨æ©Ÿé¡è‰²èƒŒæ™¯+åœ–æ¨™ï¼Œè§£æ±ºå…è²»åœ–ç‰‡ API ä¸ç©©å®šçš„å•é¡Œ
                const iconMap = {
                    'asian': 'fa-bowl-food', 'western': 'fa-burger', 'cafe': 'fa-mug-hot', 'bar': 'fa-wine-glass'
                };
                const colorMap = {
                    'asian': 'bg-orange-100 text-orange-500', 
                    'western': 'bg-red-100 text-red-500', 
                    'cafe': 'bg-amber-100 text-amber-600', 
                    'bar': 'bg-purple-100 text-purple-500'
                };

                card.innerHTML = `
                    <div class="w-20 h-20 rounded-lg  flex items-center justify-center flex-shrink-0 text-2xl">
                        <i class="fa-solid "></i>
                    </div>
                    <div class="flex-1 flex flex-col justify-center overflow-hidden">
                        <div class="flex justify-between items-start">
                            <h4 class="font-bold text-gray-800 truncate pr-2"></h4>
                        </div>
                        <div class="text-xs text-gray-500 mt-1 mb-2">
                            <span class="bg-gray-100 px-1.5 py-0.5 rounded mr-1"></span>
                            <span><i class="fa-solid fa-location-arrow fa-xs"></i>  km</span>
                        </div>
                        <div class="mt-auto">
                            <span class="text-xs text-blue-600 font-medium flex items-center gap-1">
                                æŸ¥çœ‹è©³æƒ… <i class="fa-solid fa-chevron-right text-[10px]"></i>
                            </span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // 5. éš¨æ©Ÿé¸æ“‡é‚è¼¯
        function spinTheWheel() {
            if (filteredRestaurants.length === 0) {
                alert("åˆ—è¡¨æ˜¯ç©ºçš„ï¼Œç„¡æ³•éš¨æ©Ÿé¸æ“‡ï¼è«‹èª¿æ•´ç¯„åœæˆ–ç¯©é¸æ¢ä»¶ã€‚");
                return;
            }

            // é—œé–‰ Modal å¦‚æœå®ƒæ˜¯é–‹è‘—çš„
            document.getElementById('result-modal').classList.add('hidden');

            const btn = document.getElementById('random-btn');
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<i class="fa-solid fa-circle-notch fa-spin"></i> é¸æ“‡ä¸­...`;

            // ç°¡å–®çš„ç‰¹æ•ˆ
            let count = 0;
            const maxCount = 10;
            const interval = setInterval(() => {
                count++;
                // éš¨æ©Ÿé«˜äº®ä¸€å€‹å¡ç‰‡ (è¦–è¦ºæ•ˆæœå¯é¸ï¼Œé€™è£¡ç°¡åŒ–)
                if (count >= maxCount) {
                    clearInterval(interval);
                    const finalChoice = filteredRestaurants[Math.floor(Math.random() * filteredRestaurants.length)];
                    showModal(finalChoice);
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            }, 100);
        }

        // 6. é¡¯ç¤º Modal (åŒ…å« Google é€£çµ)
        function showModal(item) {
            const modal = document.getElementById('result-modal');
            const img = document.getElementById('modal-img');
            const name = document.getElementById('modal-name');
            const tag = document.getElementById('modal-tag');
            const dist = document.getElementById('modal-dist');
            const googleLink = document.getElementById('modal-google-link');
            const mapLink = document.getElementById('modal-map-link');

            // æ§‹å»º Google Maps æœå°‹é€£çµ
            // é€™æ˜¯æœ€é—œéµçš„ä¸€æ­¥ï¼šå› ç‚ºæˆ‘å€‘æ²’æœ‰ APIï¼Œæˆ‘å€‘è®“ä½¿ç”¨è€…è·³è½‰å» Google çœ‹è©³ç´°
            const query = encodeURIComponent(``); // æœå°‹åº—å
            // ä¹Ÿå¯ä»¥åŠ ä¸ŠåŸå¸‚åå¢å¼·æº–ç¢ºåº¦ï¼Œä½† OSM ä¸ä¸€å®šæœ‰åŸå¸‚æ¬„ä½
            
            googleLink.href = `https://www.google.com/search?q=`; // æœå°‹é é¢ (çœ‹è©•åˆ†æœ€å¿«)
            mapLink.href = `https://www.google.com/maps/dir/?api=1&destination=,&destination_place_id=`; // å°èˆª

            name.innerText = item.name;
            tag.innerText = item.rawType || 'ç¾é£Ÿ';
            dist.innerText = ` km`;
            
            // ä½¿ç”¨ Picsum ä½œç‚ºç¾è§€çš„èƒŒæ™¯åœ– (éš¨æ©Ÿ)
            img.src = `https://picsum.photos/400/300?random=`;

            modal.classList.remove('hidden');
        }

        function closeModal(e) {
            if (e && e.target.id !== 'result-modal') return; // å¦‚æœé»æ“Šçš„æ˜¯ modal å…§éƒ¨å‰‡ä¸é—œé–‰ (é™¤éæœ‰é»æ“Šäº‹ä»¶å†’æ³¡è™•ç†)
            document.getElementById('result-modal').classList.add('hidden');
        }
        
        // é»æ“Š Modal å…§éƒ¨çš„é—œé–‰æŒ‰éˆ•
        document.querySelector('#result-modal button').addEventListener('click', () => {
             document.getElementById('result-modal').classList.add('hidden');
        });

        // è¼”åŠ©å‡½å¼ï¼šè¨ˆç®—è·é›¢ (Haversine Formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return (R * c).toFixed(1);
        }

        function getImageKeyword(type) {
            const keywords = cuisineImages[type] || cuisineImages['default'];
            const arr = keywords.split(',');
            return arr[Math.floor(Math.random() * arr.length)];
        }
    </script>
</body>
</html>